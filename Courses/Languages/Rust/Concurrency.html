<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"/> <meta name="viewport" content="width=device-width,initial-scale=1"/> <title>Concurrency.md</title> <link rel="stylesheet" href="https://grimoire.quantinium.dev/static/styles.css"/> <link rel="icon" href="/static/pfp.svg"/> <meta property="og:site_name" content="Quantinium"/> <meta property="og:title" content="Concurrency"/> <meta property="og:type" content="website"/> <meta name="twitter:card" content="summary_large_image"/> <meta name="twitter:title" content="Concurrency"/> <meta name="og:url" content="https://grimoire.quantinium.dev/Courses/Languages/Rust/Concurrency.md"/> <meta name="twitter:url" content="https://grimoire.quantinium.dev/Courses/Languages/Rust/Concurrency.md"/> <meta name="generator" content="grimoire"/> <meta name="twitter:domain" content="https://grimoire.quantinium.dev/"/> <meta property="og:type" content="article"/> <link rel="canonical" href="https://grimoire.quantinium.dev/Courses/Languages/Rust/Concurrency.html"/> <meta property="og:url" content="https://grimoire.quantinium.dev/Courses/Languages/Rust/Concurrency.html"/> <meta property="og:image:type" content="image/png"/> <meta property="og:image:alt" content="Concurrency"/> <meta property="og:image:url" content="https://grimoire.quantinium.dev/static/concurrency.md781070-og.png"/> <meta property="og:image" content="https://grimoire.quantinium.dev/static/concurrency.md781070-og.png"/> <meta property="og:image:width" content="1200"/> <meta property="og:image:height" content="630"/> <meta name="twitter:image" content="https://grimoire.quantinium.dev/static/concurrency.md781070-og.png"/> <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.1.0"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css"/> <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css"/> </head> <body> <div class="container"> <div class="sidebar"> <div class="sidebar-inner"> <h1 class="owner"><a href="/">Quantinium</a></h1> <div class="sidebar-theme-toggle"> <button class="theme-toggle" onclick="toggleTheme(!0)" aria-label="Toggle Theme"> <i class="ph ph-sun"></i> </button> <button class="search-button" onclick="openSearch()" aria-label="Open Search"> <i class="ph ph-magnifying-glass"></i> </button> <button class="pdf-button" onclick="printPage()" aria-label="Print Page"> <i class="ph ph-file-pdf"></i> </button> </div> <div id="file-tree" class="file-tree"></div> <div class="divider" draggable="true"></div> </div> </div> <div class="content" role="main"> <nav class="top-navbar"> <div class="top-navbar-left"> <button class="sidebar-toggle" onclick="toggleNav()" aria-label="Toggle Sidebar"> <i class="ph ph-list"></i> </button> <img class="profile-picture" src="/static/pfp.svg" alt="pfp"/> <a href="/">Quantinium</a> </div> <div class="top-navbar-right"> <button class="search-button" onclick="openSearch()" aria-label="Open Search"> <i class="ph ph-magnifying-glass"></i> </button> <button class="theme-toggle" onclick="toggleTheme(!0)" aria-label="Toggle Theme"> <i class="ph ph-sun"></i> </button> <button class="pdf-button" onclick="printPage()" aria-label="Print Page"> <i class="ph ph-file-pdf"></i> </button> </div> </nav> <div class="content-container"> <div class="content-container-inner"> <div class="page-content"> <h1></h1> <article class="markdown-content"> <p><strong>Concurrent programming</strong>, where different parts of a program execute independently</p> <h2 id="using-threads-to-run-code-simultaneously">Using Threads to run code Simultaneously</h2> <p>In an operating system, most programs are run in a process, and the operating system will manage multiple processes. Within a program, you can have different parts being run by threads.</p> <p>Concurrent programming can help us improve performance but also adds complexity to the code and can lead to bugs such as race conditions, deadlocks, etc.</p> <h3 id="threads">Threads</h3> <h4 id="creating-a-new-thread">Creating a new thread</h4> <p>To create a new thread, we call the <code>thread::spawn</code> function and pass it a closure containing the code we want to run in the new thread.</p> <pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">10</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"hi number {i} from the spawned thread!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">            <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="10">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number" line="12">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">5</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="13">        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"hi number {i} from the main thread!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14">        <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="16"><span class="token punctuation">}</span>
</span></code></pre> <blockquote> <p>When the main threads exit, all spawn threads must also exit even if they are not finished.</p> </blockquote> <h4 id="waiting-for-all-threads-to-finish">Waiting for all threads to finish</h4> <p>we can wait for a spawned thread to not end even if the main thread has finished exiting by using <code>join</code> method. The return type of <code>thread::spawn</code> is JoinHandle. A JoinHandle is an owned value that, when we call the <code>join</code> method on it, it'll wait for the thread to finish.</p> <pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">let</span> handle <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">10</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"hi number {i} from the spawned thread!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">            <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="10">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number" line="12">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">5</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="13">        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"hi number {i} from the main thread!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14">        <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17">    handle<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="18"><span class="token punctuation">}</span>
</span></code></pre> <h4 id="using-move-closures-with-threads">Using move closures with threads</h4> <p>the <code>move</code> keyword is used in closures to indicate that the closure should take ownership of the variables it captures from its surrounding environment.</p> <pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6">    <span class="token keyword">let</span> handle <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Here's a vector: {v:?}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">
</span><span class="code-line line-number" line="10">    handle<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11"><span class="token punctuation">}</span>
</span></code></pre> <p>we use the <code>move</code> keyword to pass the ownership of <code>v</code> to the new thread. The vector needs to be moved into the new thread as to make sure that the vector is being modified at one place. Since keeping it in the main thread and passing a reference in the new thread can cause bugs, therefore we transfer the ownership of <code>v</code> to the spawned thread.</p> <h2 id="using-message-passing">Using Message Passing</h2> <p>One increasingly popular approach to safe concurrency is message passing, where threads or actors communicate by sending each other messages containing data.</p> <p>To accomplish this we use channels. A channel has two halves: a transmitter and receiver.</p> <pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span>mpsc<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">let</span> <span class="token punctuation">(</span>tx<span class="token punctuation">,</span> rx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7">    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="8">        <span class="token keyword">let</span> val <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">        tx<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number" line="12">    <span class="token keyword">let</span> received <span class="token operator">=</span> rx<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Got: {received}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14"><span class="token punctuation">}</span>
</span></code></pre> <ul> <li>we create a new channel using <code>mpsc::channel</code> function. <code>mpsc - multiple producer, single customer</code>. The mpsc channel returns a tuple, <code>(tx, rx)</code> - (transmitter, receiver)</li> <li>The transmitter has a <code>send</code> method that takes the value we want to send which returns a <code>Result&#x3C;T, E></code>.</li> <li>The receiver has two useful methods: <code>recv</code> and <code>try_recv</code>.</li> </ul> <h3 id=""><strong><code>recv</code> Method</strong></h3> <p>The <code>recv</code> method blocks the current thread until a message is received from the channel. If no message is available, the thread will wait indefinitely until a message is sent.</p> <ul> <li><strong>Blocking</strong>: The thread is blocked until a message is received.</li> <li><strong>Result</strong>: Returns a <code>Result&#x3C;T, RecvError></code>. If a message is received, it returns <code>Ok(message)</code>. If the sender is dropped and no more messages will be sent, it returns <code>Err(RecvError)</code>.</li> </ul> <pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span>mpsc<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">let</span> <span class="token punctuation">(</span>tx<span class="token punctuation">,</span> rx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7">    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="8">        <span class="token keyword">let</span> val <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">        tx<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number" line="12">    <span class="token comment">// Block until a message is received</span>
</span><span class="code-line line-number" line="13">    <span class="token keyword">let</span> received <span class="token operator">=</span> rx<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Got: {}"</span><span class="token punctuation">,</span> received<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15"><span class="token punctuation">}</span>
</span></code></pre> <h3 id=""><strong><code>try_recv</code> Method</strong></h3> <p>The <code>try_recv</code> method attempts to receive a message from the channel without blocking. If no message is available, it returns immediately with an error instead of waiting.</p> <ul> <li><strong>Non-blocking</strong>: The thread is not blocked. If no message is available, it returns immediately.</li> <li><strong>Result</strong>: Returns a <code>Result&#x3C;T, TryRecvError></code>. If a message is received, it returns <code>Ok(message)</code>. If no message is available, it returns <code>Err(TryRecvError::Empty)</code>. If the sender is dropped and no more messages will be sent, it returns <code>Err(TryRecvError::Disconnected)</code>.</li> </ul> <h4 id="example">Example:</h4> <pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span>mpsc<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword">let</span> <span class="token punctuation">(</span>tx<span class="token punctuation">,</span> rx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8">    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="9">        <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Simulate some work</span>
</span><span class="code-line line-number" line="10">        <span class="token keyword">let</span> val <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">        tx<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14">    <span class="token keyword">loop</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="15">        <span class="token keyword">match</span> rx<span class="token punctuation">.</span><span class="token function">try_recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="16">            <span class="token class-name">Ok</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="17">                <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Got: {}"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="18">                <span class="token keyword">break</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="19">            <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="20">            <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token class-name">TryRecvError</span><span class="token punctuation">::</span><span class="token class-name">Empty</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="21">                <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"No message yet, doing other work..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="22">                <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Simulate other work</span>
</span><span class="code-line line-number" line="23">            <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="24">            <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token class-name">TryRecvError</span><span class="token punctuation">::</span><span class="token class-name">Disconnected</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="25">                <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Sender dropped, no more messages."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="26">                <span class="token keyword">break</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="27">            <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="28">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="29">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="30"><span class="token punctuation">}</span>
</span></code></pre> <h4 id="channels-and-ownership"><strong>Channels and Ownership:</strong></h4> <ul> <li>Channels in Rust (<code>mpsc</code>) allow threads to send and receive messages.</li> <li>When you send a value through a channel using <code>tx.send(val)</code>, <strong>ownership of the value is transferred</strong> to the receiver.</li> <li>This means you can't use the value after sending it, as it no longer belongs to the sender.</li> </ul> <pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span>mpsc<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">let</span> <span class="token punctuation">(</span>tx<span class="token punctuation">,</span> rx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7">    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="8">        <span class="token keyword">let</span> val <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">        tx<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Ownership of `val` is transferred to the receiver</span>
</span><span class="code-line line-number" line="10">        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"val is {val}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error! `val` is no longer valid here</span>
</span><span class="code-line line-number" line="11">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">
</span><span class="code-line line-number" line="13">    <span class="token keyword">let</span> received <span class="token operator">=</span> rx<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Got: {received}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15"><span class="token punctuation">}</span>
</span></code></pre> <h4 id="sending-multiple-values"><strong>Sending Multiple Values:</strong></h4> <ul> <li>You can send multiple values through a channel, and the receiver can process them one by one.</li> </ul> <pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span>mpsc<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword">let</span> <span class="token punctuation">(</span>tx<span class="token punctuation">,</span> rx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8">    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="9">        <span class="token keyword">let</span> vals <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span>
</span><span class="code-line line-number" line="10">            <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hi"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="11">            <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"from"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="12">            <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"the"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="13">            <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"thread"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="14">        <span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15">
</span><span class="code-line line-number" line="16">        <span class="token keyword">for</span> val <span class="token keyword">in</span> vals <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="17">            tx<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Send each value</span>
</span><span class="code-line line-number" line="18">            <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Pause between sends</span>
</span><span class="code-line line-number" line="19">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="20">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="21">
</span><span class="code-line line-number" line="22">    <span class="token keyword">for</span> received <span class="token keyword">in</span> rx <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="23">        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Got: {received}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Print each received value</span>
</span><span class="code-line line-number" line="24">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="25"><span class="token punctuation">}</span>
</span></code></pre> <h4 id="multiple-producers"><strong>Multiple Producers:</strong></h4> <ul> <li>You can have multiple threads sending messages to the same receiver by cloning the transmitter (<code>tx</code>).</li> </ul> <pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span>mpsc<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword">let</span> <span class="token punctuation">(</span>tx<span class="token punctuation">,</span> rx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">    <span class="token keyword">let</span> tx1 <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Clone the transmitter</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">    <span class="token comment">// First thread</span>
</span><span class="code-line line-number" line="10">    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="11">        <span class="token keyword">let</span> vals <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span>
</span><span class="code-line line-number" line="12">            <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hi"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="13">            <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"from"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="14">            <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"the"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="15">            <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"thread"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="16">        <span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="17">
</span><span class="code-line line-number" line="18">        <span class="token keyword">for</span> val <span class="token keyword">in</span> vals <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="19">            tx1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="20">            <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="21">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="22">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="23">
</span><span class="code-line line-number" line="24">    <span class="token comment">// Second thread</span>
</span><span class="code-line line-number" line="25">    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="26">        <span class="token keyword">let</span> vals <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span>
</span><span class="code-line line-number" line="27">            <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"more"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="28">            <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"messages"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="29">            <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"for"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="30">            <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"you"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="31">        <span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="32">
</span><span class="code-line line-number" line="33">        <span class="token keyword">for</span> val <span class="token keyword">in</span> vals <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="34">            tx<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="35">            <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="36">        <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="37">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="38">
</span><span class="code-line line-number" line="39">    <span class="token keyword">for</span> received <span class="token keyword">in</span> rx <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="40">        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Got: {received}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="41">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="42"><span class="token punctuation">}</span>
</span></code></pre> <h2 id="shared-state-concurrency">Shared-State Concurrency</h2> <p>Shared memory concurrency is like multiple ownership: multiple threads can access the same memory location at the same time.</p> <h3 id="using-mutexes-to-allow-access-to-data-from-one-thread-at-a-time">Using mutexes to allow access to data from one thread at a time.</h3> <p>Mutex (mutual exclusion) allows one thread to access some data at any given time. This is done using locks which signals that the thread want to access that data. This can really help in creating race conditions and deadlocks.</p> <p>If we have to access a data, we put a lock on it and when you're done with the data that mutex guards, you must unlock it for other threads to use it.</p> <h4 id="api-of-mutex">API of Mutex<t></t></h4> <pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">Mutex</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">    <span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token class-name">Mutex</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6">    <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">        <span class="token keyword">let</span> <span class="token keyword">mut</span> num <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">        <span class="token operator">*</span>num <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="10">
</span><span class="code-line line-number" line="11">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"m = {m:?}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12"><span class="token punctuation">}</span>
</span></code></pre> <p>We create a <code>Mutex&#x3C;T></code> with the <code>new</code> function. We use the lock method that returns a smart pointer called <code>MutexGuard</code>, wrapped in a <code>LockResult</code> that we handled with the call to unwrap. The <code>MutexGuard</code> implements <code>Deref</code> to point to out inner data and <code>Drop</code> trait to release the lock automatically when it goes goes out of scope.</p> <h3 id="sharing-a-mutext-between-multiple-threads-using-arct">Sharing a <code>Mutex&#x3C;T></code> Between Multiple Threads using <code>Arc&#x3C;T></code></h3> <p><code>Arc&#x3C;T></code> is a reference counter like <code>Rc&#x3C;T></code> but is atomic in nature ie it's an atomically reference counted type.</p> <pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Arc</span><span class="token punctuation">,</span> <span class="token class-name">Mutex</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Mutex</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword">let</span> <span class="token keyword">mut</span> handles <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8">    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">10</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="9">        <span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">        <span class="token keyword">let</span> handle <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="11">            <span class="token keyword">let</span> <span class="token keyword">mut</span> num <span class="token operator">=</span> counter<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">
</span><span class="code-line line-number" line="13">            <span class="token operator">*</span>num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15">        handles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="17">
</span><span class="code-line line-number" line="18">    <span class="token keyword">for</span> handle <span class="token keyword">in</span> handles <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="19">        handle<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="20">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="21">
</span><span class="code-line line-number" line="22">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Result: {}"</span><span class="token punctuation">,</span> <span class="token operator">*</span>counter<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="23"><span class="token punctuation">}</span>
</span></code></pre> <blockquote> <p><code>Rc&#x3C;T></code> came with the risk of creating reference cycles, where two <code>Rc&#x3C;T></code> came with the risk of creating reference cycles which may cause memory leaks. Similarly <code>Mutex&#x3C;T></code> comes with the risk of creating deadlocks.</p> </blockquote> </article> </div> </div> </div> <div class="container-right"> <h3 class="table-of-content">Table of Contents</h3> <div class="container-right-inner"> <nav class="toc"><ul><ul><li class="toc-level-2"><a href="#using-threads-to-run-code-simultaneously">Using Threads to run code Simultaneously</a><ul><li class="toc-level-3"><a href="#threads">Threads</a><ul><li class="toc-level-4"><a href="#creating-a-new-thread">Creating a new thread</a></li><li class="toc-level-4"><a href="#waiting-for-all-threads-to-finish">Waiting for all threads to finish</a></li><li class="toc-level-4"><a href="#using-move-closures-with-threads">Using move closures with threads</a></li></ul></li></ul></li><li class="toc-level-2"><a href="#using-message-passing">Using Message Passing</a><ul><li class="toc-level-3"><a href="#"></a></li><li class="toc-level-3"><a href="#"></a><ul><li class="toc-level-4"><a href="#example">Example:</a></li><li class="toc-level-4"><a href="#channels-and-ownership">Channels and Ownership:</a></li><li class="toc-level-4"><a href="#sending-multiple-values">Sending Multiple Values:</a></li><li class="toc-level-4"><a href="#multiple-producers">Multiple Producers:</a></li></ul></li></ul></li><li class="toc-level-2"><a href="#shared-state-concurrency">Shared-State Concurrency</a><ul><li class="toc-level-3"><a href="#using-mutexes-to-allow-access-to-data-from-one-thread-at-a-time">Using mutexes to allow access to data from one thread at a time.</a><ul><li class="toc-level-4"><a href="#api-of-mutex">API of Mutex</a></li></ul></li><li class="toc-level-3"><a href="#sharing-a-mutext-between-multiple-threads-using-arct">Sharing a Mutex<t> Between Multiple Threads using Arc<t></t></t></a></li></ul></li></ul></ul></nav> </div> </div> </div> </div> <div class="keybinding"> <ul></ul> </div> <div class="search-dialog" id="search-dialog"> <div class="search-dialog-content"> <input type="text" id="search-input" placeholder="search..." autocomplete="off"/> <button class="close-search" onclick="closeSearch()" aria-label="Close Search"><i class="ph ph-x"></i></button> <div id="search-results" class="search-results"></div> </div> </div> <script>let searchIndex=[],fuse=null,searchInitialized=!1,searchInitializing=!1,selectedResultIndex=-1,lastQuery="";function keybindingInitialize(){let n=document.querySelector(".keybinding ul");var e;n&&(n.innerHTML="",[{key:"j",desc:"Scroll down"},{key:"k",desc:"Scroll up"},{key:"gg/Home",desc:"Scroll to top"},{key:"Shift+G/End",desc:"Scroll to bottom"},{key:"Ctrl+D",desc:"Scroll half screen down"},{key:"Ctrl+U",desc:"Scroll half screen up"},{key:"Shift+T",desc:"Toggle theme"},{key:"/",desc:"Open search"},{key:"Esc",desc:"Clear focus/close help"},{key:"Shift+H",desc:"Toggle this help"}].forEach(e=>{var t=document.createElement("li");t.textContent=e.key+" - "+e.desc,n.appendChild(t)}),document.querySelector(".keybinding").classList.add("hidden"),(e=document.createElement("h4")).textContent="Keyboard Shortcuts",n.parentNode.insertBefore(e,n))}function printPage(){var e=document.querySelector(".content-container");html2pdf(e)}function debounce(t,n){let a;return function(...e){clearTimeout(a),a=setTimeout(()=>t.apply(this,e),n)}}function initializeFileTree(e){var n=document.getElementById("file-tree");if(n){let s="fileTreeExpandedState",l=new Map(JSON.parse(localStorage.getItem(s))||[]),t=document.createElement("ul");function d(n,e=""){var a=document.createElement("ul"),i=document.createElement("li");i.classList.add(n.type),a.appendChild(i);let r=e?e+"/"+n.name:n.name;if("directory"===n.type&&0<n.children.length){a=document.createElement("div"),e=(a.classList.add("directory-wrapper"),a.style.display="flex",a.style.alignItems="center",document.createElement("i")),e=(e.setAttribute("class","ph ph-caret-right directory-arrow"),a.appendChild(e),document.createElement("span"));e.setAttribute("class","dirname"),e.textContent=n.name.replaceAll("_"," ").replaceAll("-"," ").replace(".md",""),a.appendChild(e),i.appendChild(a);let t=document.createElement("ul");l.get(r)||!1?i.classList.add("open"):t.classList.add("collapsed"),n.children.forEach(e=>{e=d(e,r);t.appendChild(e)}),a.addEventListener("click",function(e){e.stopPropagation();var e=this.parentNode,t=e.classList.toggle("open");e.querySelector("ul").classList.toggle("collapsed"),l.set(r,t),localStorage.setItem(s,JSON.stringify([...l]))}),i.appendChild(t)}else"file"===n.type&&(i.textContent=n.name.replace(".md",""),i.addEventListener("click",function(e){e.stopPropagation();e=n.path.replace(/\.md$/,".html");window.location.href="/"+e}));return i}e.forEach(e=>{t.appendChild(d(e))}),n.appendChild(t)}}function toggleNav(){document.querySelector(".sidebar").classList.toggle("open")}function openSearch(){searchInitialized||searchInitializing||initializeSearch(),document.querySelector(".search-dialog").classList.add("open"),setTimeout(()=>{document.getElementById("search-input").focus()},100)}function closeSearch(){document.getElementById("search-dialog").classList.remove("open"),document.getElementById("search-input").value="",lastQuery="",selectedResultIndex=-1,document.getElementById("search-results").innerHTML=""}function toggleTheme(e=!1){let t=localStorage.getItem("theme");t||(t="dark",localStorage.setItem("theme","dark")),e&&(t="dark"===t?"light":"dark",localStorage.setItem("theme",t));e=document.body;"dark"===t?(e.classList.remove("light"),e.classList.add("dark")):"light"===t&&(e.classList.remove("dark"),e.classList.add("light"))}function initializeCopyButton(){document.querySelectorAll(".content-container-inner pre").forEach(t=>{let n=document.createElement("button");n.textContent="Copy",n.classList.add("copy-button"),n.addEventListener("click",()=>{var e=t.querySelector("code")?.textContent||t.textContent;navigator.clipboard.writeText(e).then(()=>{n.textContent="Copied!",setTimeout(()=>{n.textContent="Copy"},2e3)}).catch(e=>{console.error("Failed to copy:",e),n.textContent="Error!",setTimeout(()=>{n.textContent="Copy"},2e3)})}),t.appendChild(n)})}function toggleKeyHints(){var e=document.querySelector(".keybinding");e&&e.classList.toggle("hidden")}function extractNameFromUrl(e){return e?((e=e.split("/").filter(Boolean))[e.length-1]||"").replace(/\.html$|\.md$/,"").replace(/[-_]/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"Untitled"}function updateSelectedResult(e,t){var n=document.querySelectorAll(".result-item");0!==n.length&&(selectedResultIndex=Math.max(0,Math.min(e,t-1)),n.forEach((e,t)=>{e.classList.toggle("selected",t===selectedResultIndex),t===selectedResultIndex&&e.scrollIntoView({block:"nearest",behavior:"smooth"})}))}document.addEventListener("DOMContentLoaded",async function(){try{initializeFileTree(JSON.parse('[{"name":"Cheat_Sheets","path":"Cheat_Sheets","type":"directory","children":[{"name":"ansi_color_codes.md","path":"Cheat_Sheets/ansi_color_codes.md","type":"file","children":[]},{"name":"Git.md","path":"Cheat_Sheets/Git.md","type":"file","children":[]},{"name":"ssh_android_to_pc.md","path":"Cheat_Sheets/ssh_android_to_pc.md","type":"file","children":[]}]},{"name":"Courses","path":"Courses","type":"directory","children":[{"name":"Boot_Dev","path":"Courses/Boot_Dev","type":"directory","children":[{"name":"HTTP.md","path":"Courses/Boot_Dev/HTTP.md","type":"file","children":[]}]},{"name":"CSES","path":"Courses/CSES","type":"directory","children":[{"name":"Complete_Search.md","path":"Courses/CSES/Complete_Search.md","type":"file","children":[]},{"name":"Data_Structures.md","path":"Courses/CSES/Data_Structures.md","type":"file","children":[]}]},{"name":"Data_Structures_and_algorithms","path":"Courses/Data_Structures_and_algorithms","type":"directory","children":[{"name":"backtracking.md","path":"Courses/Data_Structures_and_algorithms/backtracking.md","type":"file","children":[]},{"name":"linear_data_structure.md","path":"Courses/Data_Structures_and_algorithms/linear_data_structure.md","type":"file","children":[]},{"name":"tree.md","path":"Courses/Data_Structures_and_algorithms/tree.md","type":"file","children":[]}]},{"name":"Languages","path":"Courses/Languages","type":"directory","children":[{"name":"Go","path":"Courses/Languages/Go","type":"directory","children":[{"name":"go.md","path":"Courses/Languages/Go/go.md","type":"file","children":[]}]},{"name":"Java","path":"Courses/Languages/Java","type":"directory","children":[{"name":"Containers.md","path":"Courses/Languages/Java/Containers.md","type":"file","children":[]},{"name":"Data_Types.md","path":"Courses/Languages/Java/Data_Types.md","type":"file","children":[]},{"name":"Expression_Statements.md","path":"Courses/Languages/Java/Expression_Statements.md","type":"file","children":[]},{"name":"Garbage_Collection.md","path":"Courses/Languages/Java/Garbage_Collection.md","type":"file","children":[]},{"name":"Interfaces.md","path":"Courses/Languages/Java/Interfaces.md","type":"file","children":[]},{"name":"intro.md","path":"Courses/Languages/Java/intro.md","type":"file","children":[]},{"name":"JVM.md","path":"Courses/Languages/Java/JVM.md","type":"file","children":[]},{"name":"OOP_Concepts.md","path":"Courses/Languages/Java/OOP_Concepts.md","type":"file","children":[]},{"name":"Operators.md","path":"Courses/Languages/Java/Operators.md","type":"file","children":[]}]},{"name":"Javascript","path":"Courses/Languages/Javascript","type":"directory","children":[{"name":"javascript.md","path":"Courses/Languages/Javascript/javascript.md","type":"file","children":[]}]},{"name":"Rust","path":"Courses/Languages/Rust","type":"directory","children":[{"name":"Async.md","path":"Courses/Languages/Rust/Async.md","type":"file","children":[]},{"name":"Collections.md","path":"Courses/Languages/Rust/Collections.md","type":"file","children":[]},{"name":"Concurrency.md","path":"Courses/Languages/Rust/Concurrency.md","type":"file","children":[]},{"name":"Enums.md","path":"Courses/Languages/Rust/Enums.md","type":"file","children":[]},{"name":"Error.md","path":"Courses/Languages/Rust/Error.md","type":"file","children":[]},{"name":"Functional.md","path":"Courses/Languages/Rust/Functional.md","type":"file","children":[]},{"name":"Generics.md","path":"Courses/Languages/Rust/Generics.md","type":"file","children":[]},{"name":"lifetimes.md","path":"Courses/Languages/Rust/lifetimes.md","type":"file","children":[]},{"name":"OOP.md","path":"Courses/Languages/Rust/OOP.md","type":"file","children":[]},{"name":"Ownership.md","path":"Courses/Languages/Rust/Ownership.md","type":"file","children":[]},{"name":"Packaging.md","path":"Courses/Languages/Rust/Packaging.md","type":"file","children":[]},{"name":"Rust_Basics.md","path":"Courses/Languages/Rust/Rust_Basics.md","type":"file","children":[]},{"name":"Smart_Pointers.md","path":"Courses/Languages/Rust/Smart_Pointers.md","type":"file","children":[]},{"name":"Structs.md","path":"Courses/Languages/Rust/Structs.md","type":"file","children":[]},{"name":"Test.md","path":"Courses/Languages/Rust/Test.md","type":"file","children":[]},{"name":"Traits.md","path":"Courses/Languages/Rust/Traits.md","type":"file","children":[]}]}]},{"name":"System_Design","path":"Courses/System_Design","type":"directory","children":[{"name":"Introduction.md","path":"Courses/System_Design/Introduction.md","type":"file","children":[]}]},{"name":"Web_Dev","path":"Courses/Web_Dev","type":"directory","children":[{"name":"Redis","path":"Courses/Web_Dev/Redis","type":"directory","children":[{"name":"redis-cli.md","path":"Courses/Web_Dev/Redis/redis-cli.md","type":"file","children":[]},{"name":"redis.md","path":"Courses/Web_Dev/Redis/redis.md","type":"file","children":[]}]}]}]},{"name":"Miscellaneous","path":"Miscellaneous","type":"directory","children":[{"name":"Self-Hosting Bitwarden.md","path":"Miscellaneous/Self-Hosting Bitwarden.md","type":"file","children":[]},{"name":"The_Caret_Conundrum.md","path":"Miscellaneous/The_Caret_Conundrum.md","type":"file","children":[]}]},{"name":"University","path":"University","type":"directory","children":[{"name":"Computer_Networks","path":"University/Computer_Networks","type":"directory","children":[{"name":"Module_1","path":"University/Computer_Networks/Module_1","type":"directory","children":[{"name":"bandwidth_and_multiplexing.md","path":"University/Computer_Networks/Module_1/bandwidth_and_multiplexing.md","type":"file","children":[]},{"name":"Data.md","path":"University/Computer_Networks/Module_1/Data.md","type":"file","children":[]},{"name":"OSI_model.md","path":"University/Computer_Networks/Module_1/OSI_model.md","type":"file","children":[]},{"name":"Protocols_and_Standards.md","path":"University/Computer_Networks/Module_1/Protocols_and_Standards.md","type":"file","children":[]},{"name":"Topologies.md","path":"University/Computer_Networks/Module_1/Topologies.md","type":"file","children":[]},{"name":"Transmission_Media.md","path":"University/Computer_Networks/Module_1/Transmission_Media.md","type":"file","children":[]},{"name":"Wired_LAN.md","path":"University/Computer_Networks/Module_1/Wired_LAN.md","type":"file","children":[]},{"name":"Wireless_LAN.md","path":"University/Computer_Networks/Module_1/Wireless_LAN.md","type":"file","children":[]}]},{"name":"Module_2","path":"University/Computer_Networks/Module_2","type":"directory","children":[{"name":"Error_Detection_and_Correction.md","path":"University/Computer_Networks/Module_2/Error_Detection_and_Correction.md","type":"file","children":[]},{"name":"Flow_Control.md","path":"University/Computer_Networks/Module_2/Flow_Control.md","type":"file","children":[]},{"name":"Multiple_Access_protocols.md","path":"University/Computer_Networks/Module_2/Multiple_Access_protocols.md","type":"file","children":[]}]},{"name":"Module_3","path":"University/Computer_Networks/Module_3","type":"directory","children":[{"name":"Address_Mapping.md","path":"University/Computer_Networks/Module_3/Address_Mapping.md","type":"file","children":[]},{"name":"Congestion_Control.md","path":"University/Computer_Networks/Module_3/Congestion_Control.md","type":"file","children":[]},{"name":"Delivery.md","path":"University/Computer_Networks/Module_3/Delivery.md","type":"file","children":[]},{"name":"Process_To_Process_Delivery.md","path":"University/Computer_Networks/Module_3/Process_To_Process_Delivery.md","type":"file","children":[]},{"name":"Routing Protocols.md","path":"University/Computer_Networks/Module_3/Routing Protocols.md","type":"file","children":[]}]}]},{"name":"Data_Mining","path":"University/Data_Mining","type":"directory","children":[{"name":"Module_1","path":"University/Data_Mining/Module_1","type":"directory","children":[{"name":"Data Mining.md","path":"University/Data_Mining/Module_1/Data Mining.md","type":"file","children":[]},{"name":"Data Preprocessing.md","path":"University/Data_Mining/Module_1/Data Preprocessing.md","type":"file","children":[]},{"name":"Intro.md","path":"University/Data_Mining/Module_1/Intro.md","type":"file","children":[]},{"name":"KDD.md","path":"University/Data_Mining/Module_1/KDD.md","type":"file","children":[]},{"name":"OLAP.md","path":"University/Data_Mining/Module_1/OLAP.md","type":"file","children":[]},{"name":"WareHouse_Schema.md","path":"University/Data_Mining/Module_1/WareHouse_Schema.md","type":"file","children":[]}]},{"name":"Module_2","path":"University/Data_Mining/Module_2","type":"directory","children":[{"name":"Advanced Pattern Mining.md","path":"University/Data_Mining/Module_2/Advanced Pattern Mining.md","type":"file","children":[]},{"name":"Association Rule Mining.md","path":"University/Data_Mining/Module_2/Association Rule Mining.md","type":"file","children":[]},{"name":"Associations and Correlations.md","path":"University/Data_Mining/Module_2/Associations and Correlations.md","type":"file","children":[]},{"name":"Cluster Analysis.md","path":"University/Data_Mining/Module_2/Cluster Analysis.md","type":"file","children":[]},{"name":"Clustering with constriants.md","path":"University/Data_Mining/Module_2/Clustering with constriants.md","type":"file","children":[]},{"name":"Density Based Methods.md","path":"University/Data_Mining/Module_2/Density Based Methods.md","type":"file","children":[]},{"name":"Frequent Pattern Mining.md","path":"University/Data_Mining/Module_2/Frequent Pattern Mining.md","type":"file","children":[]},{"name":"Hierarchical Methods.md","path":"University/Data_Mining/Module_2/Hierarchical Methods.md","type":"file","children":[]},{"name":"Outlier Detection.md","path":"University/Data_Mining/Module_2/Outlier Detection.md","type":"file","children":[]},{"name":"Sequential Pattern mining.md","path":"University/Data_Mining/Module_2/Sequential Pattern mining.md","type":"file","children":[]},{"name":"Similarity and Distance Measure.md","path":"University/Data_Mining/Module_2/Similarity and Distance Measure.md","type":"file","children":[]}]}]},{"name":"Economics","path":"University/Economics","type":"directory","children":[{"name":"Module_1.md","path":"University/Economics/Module_1.md","type":"file","children":[]},{"name":"Module_3.md","path":"University/Economics/Module_3.md","type":"file","children":[]}]},{"name":"OOP","path":"University/OOP","type":"directory","children":[{"name":"Module_1","path":"University/OOP/Module_1","type":"directory","children":[{"name":"Basic_Concepts.md","path":"University/OOP/Module_1/Basic_Concepts.md","type":"file","children":[]},{"name":"Intro.md","path":"University/OOP/Module_1/Intro.md","type":"file","children":[]}]},{"name":"Module_3","path":"University/OOP/Module_3","type":"directory","children":[{"name":"Exceptions.md","path":"University/OOP/Module_3/Exceptions.md","type":"file","children":[]},{"name":"Interfaces.md","path":"University/OOP/Module_3/Interfaces.md","type":"file","children":[]},{"name":"Packages.md","path":"University/OOP/Module_3/Packages.md","type":"file","children":[]},{"name":"Threads.md","path":"University/OOP/Module_3/Threads.md","type":"file","children":[]}]},{"name":"Module_4","path":"University/OOP/Module_4","type":"directory","children":[{"name":"IO.md","path":"University/OOP/Module_4/IO.md","type":"file","children":[]},{"name":"Strings.md","path":"University/OOP/Module_4/Strings.md","type":"file","children":[]},{"name":"Swing.md","path":"University/OOP/Module_4/Swing.md","type":"file","children":[]}]},{"name":"Module_1.md","path":"University/OOP/Module_1.md","type":"file","children":[]}]}]},{"name":"index.md","path":"index.md","type":"file","children":[]}]'))}catch(e){console.error("Error parsing file tree:",e)}toggleTheme(),initializeCopyButton(),toggleKeyHints(),keybindingInitialize(),initializeSearch();var e=document.getElementById("search-input");e.addEventListener("input",handleSearch),e.addEventListener("keydown",function(e){"Escape"===e.key&&closeSearch()})}),document.getElementById("search-input").addEventListener("keydown",function(e){var t=document.querySelectorAll(".result-item");if(t.length)switch(e.key){case"ArrowDown":e.preventDefault(),updateSelectedResult(selectedResultIndex+1,t.length);break;case"ArrowUp":e.preventDefault(),updateSelectedResult(selectedResultIndex-1,t.length);break;case"Enter":e.preventDefault(),0<=selectedResultIndex&&t[selectedResultIndex].querySelector("a").click();break;case"Escape":e.preventDefault(),closeSearch()}}),document.getElementById("search-dialog").addEventListener("click",function(e){e.target===this&&closeSearch()}),document.addEventListener("keydown",function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&!e.target.isContentEditable){var t=e.key.toLowerCase();switch(window.lastGPress||(window.lastGPress={count:0,time:0}),t){case"j":e.preventDefault(),window.scrollBy(0,50);break;case"k":e.preventDefault(),window.scrollBy(0,-50);break;case"g":e.shiftKey?(e.preventDefault(),window.scrollTo(0,document.body.scrollHeight)):(n=Date.now())-window.lastGPress.time<500&&1===window.lastGPress.count?(e.preventDefault(),window.scrollTo(0,0),window.lastGPress.count=0):(window.lastGPress.count=1,window.lastGPress.time=n);break;case"u":e.ctrlKey&&(e.preventDefault(),window.scrollBy(0,-window.innerHeight/2));break;case"d":e.ctrlKey&&(e.preventDefault(),window.scrollBy(0,window.innerHeight/2));break;case"r":e.ctrlKey&&(e.preventDefault(),window.location.reload());break;case"/":e.preventDefault(),openSearch();break;case"escape":document.activeElement&&document.activeElement.blur();var n=document.querySelector(".keybinding");n&&!n.classList.contains("hidden")&&n.classList.add("hidden"),closeSearch();break;case"home":e.preventDefault(),window.scrollTo(0,0);break;case"end":e.preventDefault(),window.scrollTo(0,document.body.scrollHeight);break;case"h":e.shiftKey&&(e.preventDefault(),toggleKeyHints());break;case"t":e.shiftKey&&(e.preventDefault(),toggleTheme(!0))}}}),document.getElementById("search-dialog").addEventListener("click",function(e){e.target===this&&closeSearch()});let debouncedHandleSearch=debounce(function(e){let t=e.target.value.trim();var n=document.getElementById("search-results");t!==lastQuery&&((lastQuery=t)?searchInitialized?fuse&&searchIndex.length?displaySearchResults(fuse.search(t),t,n):(n.innerHTML='<p class="search-error">Search unavailable. Retrying...</p>',initializeSearch().then(()=>t&&handleSearch(e))):(n.innerHTML='<p class="search-loading">Search is initializing...</p>',searchInitializing||initializeSearch().then(()=>t&&handleSearch(e))):n.innerHTML='<p class="search-ready">Type to start searching...</p>')},300);function displaySearchResults(e,s,l){var t,n;l.innerHTML="",selectedResultIndex=-1,e.length?(t=Math.min(e.length,10),e.slice(0,t).forEach((e,t)=>{var n=e.item,e=e.matches||[],a=document.createElement("div"),t=(a.className="result-item",a.dataset.index=t,document.createElement("a")),i=(t.href=n.url,t.className="result-link",t.addEventListener("click",closeSearch),document.createElement("div")),r=(i.className="result-title",n.name||extractNameFromUrl(n.url)),r=(i.innerHTML=highlightMatch(r,e.filter(e=>"name"===e.key)),document.createElement("div"));r.className="result-snippet",r.innerHTML=n.content?generateSnippet(n.content,s):"No preview available",t.appendChild(i),t.appendChild(r),a.appendChild(t),l.appendChild(a)}),e.length>t&&((n=document.createElement("p")).className="search-show-more",n.textContent=`Showing ${t} of ${e.length} results.`,l.appendChild(n))):l.innerHTML='<p class="no-results">No results found.</p>'}function handleSearch(e){debouncedHandleSearch(e)}async function initializeSearch(){if(!searchInitializing){searchInitializing=!0;var t=document.getElementById("search-results");try{console.log("Initializing search..."),t&&(t.innerHTML='<p class="search-loading">Loading search index...</p>');var e=await fetch("/static/search-index.json");if(!e.ok)throw new Error("Failed to fetch search index: "+e.status);var n,a=await e.json();if(!Array.isArray(a))throw new Error("Invalid search index format");searchIndex=a,fuse=new Fuse(searchIndex,{keys:[{name:"name",weight:.5},{name:"content",weight:.3},{name:"tags",weight:.2}],threshold:.3,distance:200,includeScore:!0,includeMatches:!0,useExtendedSearch:!0,ignoreLocation:!1,minMatchCharLength:2,shouldSort:!0}),console.log("Search initialized with",searchIndex.length,"items"),searchInitialized=!0,t&&document.querySelector(".search-dialog").classList.contains("open")&&(t.innerHTML='<p class="search-ready">Type to start searching...</p>',(n=document.getElementById("search-input"))?.value.trim())&&handleSearch({target:n})}catch(e){console.error("Search init failed:",e),searchInitialized=!1,t&&(t.innerHTML=`
                <p class="search-error">Failed to load search: ${e.message}</p>
                <button class="retry-button" onclick="initializeSearch()">Retry</button>`)}finally{searchInitializing=!1}}}function highlightMatch(n,e){if(!e||!e.length)return n;let a=n;return e.forEach(e=>{var t=e.indices[0][0],e=e.indices[0][1]+1,t=n.slice(t,e);a=a.replace(t,`<mark>${t}</mark>`)}),a}function generateSnippet(e,t,n=100){var a=e.toLowerCase(),i=t.toLowerCase(),a=a.indexOf(i),i=Math.max(0,a-50);let r=e.slice(i,i+n);return(r=0<i?"..."+r:r).length<e.length&&(r+="..."),highlightMatch(r,[{indices:[[a-i,a-i+t.length-1]]}])}</script> </body> </html> 